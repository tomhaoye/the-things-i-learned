# 负载均衡
负载均衡是分布式系统架构设计中必须考虑的因素之一。它通常指将请求/数据［均匀］的分摊到多个操作单元上面执行，负载均衡的关键在于［均匀］

### 常见的负载均衡方案
分为客户端层、反向代理层、站点层、服务层、数据层。

- ［客户端层－》反向代理层］的负载均衡
	- 通过DNS轮询实现。DNS－server对于一个域名配置了多个解析ip，每次DNS解析请求来访问DNS－server，会轮询返回这些ip，保证每个ip的解析概率是相同的。这些ip是外网ip，以做到每台服务器的请求分配也是均衡的
- ［反向代理层－》站点层］
	- 通过例如nginx来实现。修改nginx.conf，可实现多种负载均衡策略
		- 请求轮询：和DNS轮询类似，请求依次路由到各个webserver
		- 最少连接路由：哪个webserver的连接数少，路由到哪个webserver
		- ip哈希：按照访问用户的ip哈希值来路由webserver，只要用户的ip分布是均匀的，请求理论上也是均匀的。
- ［站点层－》服务层］的负载均衡
	- 通过服务连接池来实现。上游连接池会建立下游服务多个连接，每次请求会随机选区连接来访问下游服务
- ［数据差］的负载均衡
	- 在数据量很大的情况下，由于数据层设计数据的水平切分，所以数据层的负载均衡更为负载一些，它分为数据的均衡与请求的均衡。
		- 数据的均衡：水平切分后的每个服务，数据量是差不多的。
		- 请求的均衡：水平切分后的每个服务，请求量是差不多的。
	- 水平切分的种类
		- 按照range水平切分
			- 好处
				- 规则简单
				- 数据均衡性好
				- 比较容易扩展
			- 不足
				- 请求的负载不一定均衡
		- 按照id哈希水平切分
			- 好处
				- 规则简单
				- 数据均衡性好
				- 请求均匀性好
			- 不足
				- 不容易扩展
