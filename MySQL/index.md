InnoDB索引
---

### 重要概念

> #### InnoDB 中数据既是索引，索引既是数据 

### 索引类型

- 聚簇索引：就是以主键创建的索引，叶子节点包含了所有列的值，不需要回表查询
```sql
select * from test where id = 1;        #此处id为主键，const类型，即聚簇索引或唯一二级索引
```
- 非聚簇索引(二级索引)：就是以非主键创建的索引，叶子节点只包含了主键与索引列的值，有可能需要回表查询，当发生索引覆盖现象时候不需要回表查询



### 建议建立索引

- 主键（全局唯一键）
- 常用在join的列
- 经常需要搜索的列
- 经常需要排序的列
- 常需要进行范围搜索的列
- 进程使用where子句的列

### 不建议建立索引

- 可枚举的列
- 查询中很少使用到的列
- 增删改远大于检索的列
- 数据结构为text、image、bit的列


### 最左前缀原则

- 联合索引(a,b,c)
```sql
select * from test where a=1 and b=2;	#有使用索引，ref类型，即二级索引
select * from test where c=1 and a=2;	#有使用索引，ref类型，即二级索引
select b from test where b=1 and c=2;	#index类型，即扫描二级索引全表，但不需要回表
select * from test where b=1 and c=2;	#all类型，即扫描聚簇索引全表
```
> 理论上都能够使用索引，但是此联合索引建立的索引是按照a字段进行排序的，如果a字段没有在查询条件中出现，则其他字段实际上也是需要遍历每一个节点，所以最左前缀原则在索引中是非常强调的一点。
- 联合索引，key由多个列组成，索引只能用于查找key是否存在，遇到范围查询(>、<、between、like左匹配)等就不能进一步匹配了，后续会退化为线性查找。
    + 如：有索引(a, b, c, d)，查询条件`a = 1 and b = 2 and c > 3 and d = 4`，则会在每个节点依次命中a、b、c，无法命中d。

### 其他

- 为什么需要索引？
    + 适当的索引可以减少查询所消耗的时间
    + 唯一性索引可以保证该列数据的唯一性
- 为什么不给所有的列都建立索引？
    + 一般业务中并非所有列都需要作为查询条件，多余的索引需要占用更大的空间
    + 在增删改数据的时候，索引也需要动态改变，太多的索引会让这些操作变得十分的缓慢
- 常见的索引都使用哪些数据结构？
    + B+tree：[详细资料](https://github.com/tomhaoye/daily-note/blob/master/MySQL/b-tree.md)
    + hashtable：使用 hashtable 作为索引并不常见，主要因为 hashtable 需要占用更大的空间，以及不能够在范围查询中使用。
- 什么是索引覆盖现象？
    + 包含所有需要查找的字段的值的索引我们就称作索引覆盖，能够避免回表查询
